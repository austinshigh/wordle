<!-- https://austinshigh.github.io/ttt2/ttt3.html -->

<!DOCTYPE html>
<head>
    <title>Tic Tac Toe Assignment Part 1</title>
    <style type="text/css">
		.grid{display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr; grid-template-rows: 1fr 1fr 1fr 1fr 1fr 1fr;}
		.square {text-align: center; width: 70px; height: 70px; margin: 5px; border: 1px; border-color: black; border-style: solid; font-size: 60px;}
        .turn{border: 1px; border-color: black; border-style: solid; width: 100px;}
        .winner{border: 1px; border-color: green; border-style: solid; width: 100px;}
        .keyboard{display: flex; flex-direction: column; align-items: center;}
        .row{display: flex; flex-direction: row;}
        .key{text-align: center; width: 35px; height: 35px; margin: 5px; border: 1px; border-color: rgb(0, 132, 255); border-style: solid; font-size: 28px; border-radius: 5px;}
        .key:hover{background-color: rgb(0, 132, 255);}
        .wideKey{text-align: center; height: 25px; margin: 5px; border: 1px; border-color: rgb(0, 132, 255); border-style: solid; font-size: 20px; border-radius: 5px; width: 80px;}
        .wideKey:hover{background-color: rgb(0, 132, 255);}
        .disable{pointer-events: none; background-color: grey;}
        .correct{background-color: lightgreen;}
        .close{background-color: rgb(238, 190, 20);}
        .gridContainer{display: flex; justify-content: center;}
        .container{display: flex; flex-direction: column; align-items: center;;}
        .keyboard{margin-top: 30px;}
        #newGame{width: 100px;}
        #debugMode{width: 100px;}
        .active{background-color: rgb(0, 132, 255); color: white;}
        #correctAnswerContainer{color: green; display: none;}
        .show{display:block !important;}
	</style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body>
    <div class="container">
        <div id="correctAnswerContainer"></div>
        <div class="row">
            <div class="wideKey" id="newGame">New Game</div>
            <div class="wideKey" id="debugMode">Debug</div>
        </div>
        <div class="gridContainer">
        </div>
        <div class="keyboard">
            <div class="row">
                <div class="key" id="q">Q</div>
                <div class="key" id="w">W</div>
                <div class="key" id="e">E</div>
                <div class="key" id="r">R</div>
                <div class="key" id="t">T</div>
                <div class="key" id="y">Y</div>
                <div class="key" id="u">U</div>
                <div class="key" id="i">I</div>
                <div class="key" id="o">O</div>
                <div class="key" id="p">P</div>
            </div>
            <div class="row">
                <div class="key" id="a">A</div>
                <div class="key" id="s">S</div>
                <div class="key" id="d">D</div>
                <div class="key" id="g">G</div>
                <div class="key" id="h">H</div>
                <div class="key" id="j">J</div>
                <div class="key" id="k">K</div>
                <div class="key" id="l">L</div>
            </div>
            <div class="row">
                <div class="key" id="z">Z</div>
                <div class="key" id="x">X</div>
                <div class="key" id="c">C</div>
                <div class="key" id="v">V</div>
                <div class="key" id="b">B</div>
                <div class="key" id="n">N</div>
                <div class="key" id="m">M</div>
            </div>
            <div class="row">
                <div id="enterKey" class="wideKey">Enter</div>
                <div id="backspace" class="wideKey">Delete</div>
            </div>
        </div>
    </div>
</body>
<script>
    window.addEventListener('DOMContentLoaded', function() {
    (async function($) {
        const NUM_SQUARES = 5;
        const NUM_ROWS = 6;
        let currentRow = 0;
        let currentCol = 0;
        let guess = [];

        const correctAnswerContainer = $("#correctAnswerContainer");
        const backspaceKey = $("#backspace");
        const enterKey = $("#enterKey");
        const restartGameKey = $("#newGame");
        const debugKey = $("#debugMode");

        let lettersGuessed = [];
        let answer = await generateNewWord();

        const gridContainer = $('.gridContainer');
        let gridHTML = "<div class='grid'>";
        for (i=0; i<NUM_ROWS; i++){
            for (j=0; j<NUM_SQUARES; j++)
            {
                gridHTML += `<div class= "square row${i} col${j}"></div>`;
            }
        }
        gridHTML += "</div>";

        $(gridContainer).html(gridHTML);

        function addKeyListeners(){
            $('.key').each((index, key)=>{
                $(key).on("click", (e) => {
                    letter = $(key).text();
                    updateGuess(letter, key);
                });
            })

            $(enterKey).on("click", (e) =>{
                checkAnswer();
            })
            

            $(backspaceKey).on("click", (e) =>{
                backspace();
            })

            $(restartGameKey).on("click", () => {
                clearBoard();
                answer = generateNewWord();
            })

            $(debugKey).on("click", () => {
                $(correctAnswerContainer).toggleClass("show");
                $(debugKey).toggleClass("active");
            })
        };

        function updateGuess(letter, key){
            if (currentCol < 5){
                guess.push(letter.toLowerCase());
                lettersGuessed.push(key);
                let square = $(`.row${currentRow}.col${currentCol}`);
                $(square).text(letter);
                currentCol += 1;
            }
        }

        function clearBoard(){
            guess = [];
            lettersGuessed = [];
            currentCol = 0;
            currentRow = 0;
            let squares = $('.square');
            $(squares).each((index, square) => {
                $(square).text("");
                $(square).removeClass("correct");
                $(square).removeClass("close");
            })
            $('.key').each((index, key) => {
                $(key).removeClass("disable");
            })
        }

        function backspace(){
            guess.pop();
            lettersGuessed.pop();
            let square = $(`.row${currentRow}.col${currentCol - 1}`);
            $(square).text("");
            if (currentCol > 0){
                currentCol -= 1;
            }
        }

        async function checkAnswer(){
            if (currentCol === 5){
                let validGuess = await checkWordDefinition(guess.join(""));
                if (!validGuess){
                    alert("Word not found in word list");
                }else{
                    console.log(answer);
                    console.log(guess);
                    let correctLetters = 0;
                    let row = $(`.row${currentRow}`);
                    for(i = 0; i < 5; i++){
                        if (answer[i] === guess[i]){
                            $(row[i]).addClass("correct");
                            $(`#${guess[i]}`).addClass("correct");
                            correctLetters += 1;
                        }else if(answer.includes(guess[i])){
                            $(row[i]).addClass("close");
                        }else{
                            $(`#${guess[i]}`).addClass("disable");
                        }
                    }
                    if(correctLetters === 5){
                        console.log("you win!");
                    }  
                    currentCol = 0;
                    currentRow += 1;    
                    guess = [];
                }
            }
        }

        async function generateNewWord(){
            console.log("generate new word");
            let word = await fetch('https://random-word-api.herokuapp.com/word?length=5')
            .then((response) => {
                return response.json();
            })
            .then((data) => {
                return data[0]            
            }).catch((error) => {
                throw new Error("Error: Random-Word-API Error")
            })
            let validDefinition = await checkWordDefinition(word);
            if (validDefinition){
                console.log(word.split(""));
                $(correctAnswerContainer).text(word);
                return word.split("");
            }else{
                console.log('trigger-re-run');
                generateNewWord();
            }
        }

        async function checkWordDefinition(word){
            let result = await fetch("https://api.dictionaryapi.dev/api/v2/entries/en/" + word)
            .then((response) => {
                return response.json();
            }).then((data) => {
                if (data.title === "No Definitions Found"){
                    return false;
                }else{
                    return true;
                }
            }).catch((error) => {
                if (error.status === 404){
                    return false;
                }else{
                    throw new Error("Error: Dictionary API");
                }
            })
            return result;
        }

        addKeyListeners();
        
        // const selectionBox = document.getElementById("selected");

        // for (let i = 0; i < NUM_SQUARES; i++) {
        //     let square = document.getElementById(`sq${i}`);
        //     square.addEventListener('click', () =>{
        //         selectionBox.innerHTML = `${i}`;
        //         square.innerHTML = "X";
        //     });
        // }
    })(jQuery);
    });

</script>
</html>